<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Diario de Comidas con IA</title>
<style>
body { font-family: Arial; max-width: 800px; margin:auto; padding:20px; }
nav { display:flex; gap:20px; margin-bottom:20px; }
nav button { padding:8px 16px; cursor:pointer; }
section { display:none; }
section.active { display:block; }
.dia { display:inline-block; width:50px; height:50px; border:1px solid #ccc; margin:2px; text-align:center; line-height:50px; cursor:pointer; }
.dia.cumplido { background-color: #a8e6a1; }
</style>
</head>
<body>

<h1>üçΩÔ∏è Diario de Comidas</h1>

<nav>
  <button onclick="abrirSeccion('a√±adir')">A√±adir Comida</button>
  <button onclick="abrirSeccion('calendario')">Calendario</button>
</nav>

<!-- A√±adir Comida -->
<section id="a√±adir">
  <label>Fecha:</label>
  <input type="date" id="fecha_comida"><br><br>

  <label>Comida:</label>
  <select id="tipo_comida">
    <option value="desayuno">Desayuno</option>
    <option value="comida">Comida</option>
    <option value="merienda">Merienda</option>
    <option value="cena">Cena</option>
  </select><br><br>

  <label>Texto:</label>
  <textarea id="texto_comida"></textarea><br><br>

  <label>Foto:</label>
  <input type="file" id="foto_comida" accept="image/*"><br><br>

  <label>Audio:</label>
  <input type="file" id="audio_comida" accept="audio/*"><br><br>

  <button onclick="guardarComida()">Guardar Comida</button>
</section>

<!-- Calendario -->
<section id="calendario">
  <label>Objetivo de macros:</label><br>
  Prote√≠nas: <input type="number" id="objetivo_prote" value="150"> 
  Grasas: <input type="number" id="objetivo_gras" value="50"> 
  Carbs: <input type="number" id="objetivo_carbs" value="300"> 
  <button onclick="guardarObjetivo()">Guardar objetivo</button>
  <div id="dias"></div>
  <div id="detalle_dia"></div>
</section>

<script>
// Funciones para cambiar de secci√≥n
function abrirSeccion(id){
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// Inicializa fecha de hoy en a√±adir comida
document.getElementById('fecha_comida').value = new Date().toISOString().substr(0,10);

// LocalStorage
function cargarDatos(){ return JSON.parse(localStorage.getItem('diario')) || {}; }
function guardarDatos(datos){ localStorage.setItem('diario', JSON.stringify(datos)); }

// Guardar comida
function guardarComida(){
  const fecha = document.getElementById('fecha_comida').value;
  const tipo = document.getElementById('tipo_comida').value;
  const texto = document.getElementById('texto_comida').value;
  // TODO: leer foto/audio como base64
  const comida = { texto, macros: {proteinas: 20, grasas: 15, carbs:30} }; // ejemplo
  const datos = cargarDatos();
  if(!datos[fecha]) datos[fecha] = {};
  if(!datos[fecha][tipo]) datos[fecha][tipo] = [];
  datos[fecha][tipo].push(comida);
  guardarDatos(datos);
  alert("Comida guardada!");
  mostrarCalendario();
}

// Guardar objetivo
function guardarObjetivo(){
  const datos = cargarDatos();
  datos.objetivo = {
    proteinas: Number(document.getElementById('objetivo_prote').value),
    grasas: Number(document.getElementById('objetivo_gras').value),
    carbs: Number(document.getElementById('objetivo_carbs').value)
  };
  guardarDatos(datos);
  mostrarCalendario();
}

// Mostrar calendario b√°sico
function mostrarCalendario(){
  const datos = cargarDatos();
  const diasDiv = document.getElementById('dias');
  diasDiv.innerHTML = '';
  for(let fecha in datos){
    if(fecha === 'objetivo') continue;
    const div = document.createElement('div');
    div.className = 'dia';
    div.textContent = fecha.split('-')[2]; // d√≠a del mes
    // comprobar si cumple macros
    const objetivo = datos.objetivo || {proteinas:0, grasas:0, carbs:0};
    let totales = {proteinas:0, grasas:0, carbs:0};
    for(let tipo in datos[fecha]){
      datos[fecha][tipo].forEach(c => {
        totales.proteinas += c.macros.proteinas;
        totales.grasas += c.macros.grasas;
        totales.carbs += c.macros.carbs;
      });
    }
    if(totales.proteinas>=objetivo.proteinas &&
       totales.grasas>=objetivo.grasas &&
       totales.carbs>=objetivo.carbs){
      div.classList.add('cumplido');
    }
    div.onclick = ()=> mostrarDetalleDia(fecha);
    diasDiv.appendChild(div);
  }
}

// Mostrar detalle de un d√≠a
function mostrarDetalleDia(fecha){
  const datos = cargarDatos();
  const detalle = document.getElementById('detalle_dia');
  if(!datos[fecha]) { detalle.innerHTML = "Sin datos"; return; }
  let html = `<h3>Detalles ${fecha}</h3>`;
  for(let tipo in datos[fecha]){
    html += `<b>${tipo}</b><ul>`;
    datos[fecha][tipo].forEach(c => html += `<li>${c.texto} (Prote: ${c.macros.proteinas}, Gras: ${c.macros.grasas}, Carb: ${c.macros.carbs})</li>`);
    html += `</ul>`;
  }
  detalle.innerHTML = html;
}

mostrarCalendario();
abrirSeccion('a√±adir');
</script>

</body>
</html>
